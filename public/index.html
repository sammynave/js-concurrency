<!doctype html>
<html class="no-js" lang="">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>

  <body>
    <script src="js-concurrency.iife.js"></script>

    <div id="ex-1">
      <h3>random numbers</h3>
      <button id="pick-random-numbers">pick random numbers</button> random number: <span id="random-numbers"></span>
    </div>
    <script>
      (function () {
      // From ember-concurrency.com
      const button = document.getElementById('pick-random-numbers')
      const numbers = document.getElementById('random-numbers')
      const ex = jsc.task(function *() {
        let nums = [];

        for (let i = 0; i < 3; i++) {
          nums.push(Math.floor(Math.random() * 10));
        }

        numbers.textContent = nums.join(', ');
      });

      button.addEventListener('click', function() {
        ex.perform();
      });
    })();
    </script>

    <h2 style="border-bottom: 8px solid black;"></h2>

    <div id="ex-2">
      <h3>using `yield` - fetch random name from faker.io</h3>
      <div>status: <span id="random-name-status"></span></div>
      <button id="fetch-name">random name</button> fetch random name: <span id="random-name"></span>
    </div>
    <script>
      (function () {
        const button = document.getElementById('fetch-name')
        const nameEl = document.getElementById('random-name')
        const statusEl = document.getElementById('random-name-status')
        const ex = jsc.task(function *() {
          const resp = yield fetch('http://faker.hook.io/?property=name.findName&locale=en');
          const name = yield resp.text();

          nameEl.textContent = name;
        });

        button.addEventListener('click', function() {
          const task = ex.perform();
          const unsubscribe = task.subscribe((changed, { state, value }) => {
            /*
             * TODO: slightly annoying to push this onto
             * the user. think of a better way
             */

            if (changed.state) {
              statusEl.textContent = state;
            }

            if (changed.value) {
              console.log(value);
            }
          });
        });
      })();
    </script>
  </body>
</html>
